(function(e,t){var n=function(e,t){this.init()};n.prototype={$menus:[],$timers:[],$clickActions:[],init:function(){var n=-1;this.$menus=t(e).find(".clickbeetle-menu");this.$timers.length=0;this.$timers.length=this.$menus.length;this.$clickActions.length=0;this.$clickActions.length=this.$menus.length;while(typeof this.$menus[++n]!=="undefined"){this.appendTabElement(this.$menus[n]);this.coreBindings(this.$menus[n]);this.setAttributes(this.$menus[n]);if(t(this.$menus[n]).hasClass("hover")){this.hoverBindings(this.$menus[n],n)}else if(t(this.$menus[n]).hasClass("click")){this.clickBindings(this.$menus[n],n)}}},appendTabElement:function(e){t(e).append("<div></div>")},setAttributes:function(e){t(e).attr("role","navigation");t(e).find("a").attr("role","menuitem");if(!t(e).hasClass("hide")){t(e).addClass("hide")}t(e).children().last().attr("tabindex",0)},coreBindings:function(e){var n=t(t(e).children()).last();firstAnchor=t(e).find("a")[0],$this=this;t(e).find("a").unbind("focus").bind("focus",function(e){$this.focusAction(e)});t(firstAnchor).unbind("blur").bind("blur",function(e){$this.blurAction(e)});t(n).unbind("focus").bind("focus",function(e){$this.focusAction(e)}).unbind("blur").bind("blur",function(e){$this.blurAction(e)})},hoverBindings:function(e,n){function i(e){if(r.$timers[e]!==null){clearTimeout(r.$timers[e]);r.$timers[e]=null}}var r=this;t(e).unbind("mouseenter").bind("mouseenter",function(e){r.focusAction(e)}).unbind("mouseleave").bind("mouseleave",function(e){i(n);r.$timers[n]=setTimeout(function(){r.blurAction(e)},200)});t(e).children().unbind("mouseenter").bind("mouseenter",function(e){i(n);r.focusAction(e)})},clickBindings:function(e,n){var r=this,i=t(e).find("a"),s=0;t(e).find("a").first().unbind("click").bind("click",function(i){if(t(e).hasClass("hide")||r.$clickActions[n]!==true){r.focusAction(i);r.$clickActions[n]=true}else{r.blurAction(i);t(r.findMenuTop(i.target)).blur();r.$clickActions[n]=false}i.stopPropagation();return false});while(typeof (anchor=i[++s])!=="undefined"){t(anchor).unbind("click").bind("click",function(e){r.blurAction(e);r.$clickActions[n]=false;t(e.target).blur();e.stopPropagation();return true})}},focusAction:function(e){var t=this.findMenuTop(e.target);this.classRemoveAll(t,"hide");this.classAddOnce(t,"show")},blurAction:function(e){var t=this.findMenuTop(e.target);this.classRemoveAll(t,"show");this.classAddOnce(t,"hide")},findMenuTop:function(e){var n=e;while(!t(n).hasClass("clickbeetle-menu")){n=t(n).parent()}return n},classRemoveAll:function(e,n){while(t(e).hasClass(n)){t(e).removeClass(n)}},classAddOnce:function(e,n){if(!t(e).hasClass(n)){t(e).addClass(n)}}};t(e).ready(function(e,t){clickbeetle=new n(e,t)})})(document,$)